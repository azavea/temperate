<div class="main-container">
  <main class="main-content" role="main">
    <app-back-button></app-back-button>
    <section>
      <h2 class="heading">Vulnerability Assessment
        <button class="button icon-edit" routerLink="risk/new"></button>
      </h2>
      <h1 *ngIf="weatherEvent?.name">{{ weatherEvent?.name }}</h1>
    </section>
    <section>
      <h2>Your city's risks</h2>
      <p>Based on your chosen scope, we have identified the below hazards as
        a high priority to assess vulnerability and include in your report.
        Click on a row to assess each risk.
      </p>
    </section>
    <section class="display-flex flex-vertical">
      <div class="loading-wrapper" *ngIf="risks === undefined">
        <div class="loading loading-spinner loading-large loading-primary"></div>
      </div>
      <div *ngIf="risks?.length === 0">
        <h2>No risks available</h2>
      </div>
      <table class="table va-summary-table" *ngIf="risks?.length">
        <caption>
          Wondering why we selected these risks?
          <button class="button button-link"
                  [popover]="learnMoreRiskPopover"
                  [outsideClick]="true"
                  container="body"
                  placement="bottom">Learn more</button>
        </caption>
        <thead>
          <tr>
            <th>Adaptive Need</th>
            <th>Risk
              <i class="icon-question-circle-o" [tooltip]="tooltipText.risk"></i>
            </th>
            <th>Potential Impact
              <i class="icon-question-circle-o" [tooltip]="tooltipText.potentialImpact"></i>
            </th>
            <th>Adaptive Capacity
              <i class="icon-question-circle-o" [tooltip]="tooltipText.adaptiveCapacity"></i>
            </th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let risk of risks">
            <td><va-adaptive-need-box
              [adaptiveCapacity]="risk.adaptive_capacity"
              [popoverPlacement]="'right'"
              [potentialImpact]="risk.impact_magnitude"></va-adaptive-need-box></td>
            <td>
              <va-risk-popover [risk]="risk"></va-risk-popover>
            </td>
            <td>{{ risk.impact_magnitude }}</td>
            <td>{{ risk.adaptive_capacity }}</td>
            <td>
              <button class="button va-status-button"
                      *ngIf="!risk.isAssessed() && !risk.isPartiallyAssessed()"
                      [routerLink]="['risk', risk.id]">Assess</button>
              <button class="button va-status-button in-progress"
                      *ngIf="!!risk.isAssessed()"
                      (click)="takeAction(risk)">Take Action</button>
            </td>
            <td>
              <div class="btn-group" dropdown>
                <button dropdownToggle type="button" class="button dropdown-toggle">
                  <span class="icon-ellipsis"></span>
                </button>
                <ul *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu">
                  <li role="menuitem">
                    <a class="dropdown-item" [routerLink]="['risk', risk.id]" [queryParams]="{goToStep:4}">View</a>
                  </li>
                  <li role="menuitem">
                    <a class="dropdown-item" [routerLink]="['risk', risk.id]">Edit</a>
                  </li>
                  <li role="menuitem">
                    <a class="dropdown-item" (click)="deleteRisk(risk)">Remove</a>
                  </li>
                </ul>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </section>
  </main>
</div>

<ng-template #learnMoreRiskPopover>
  <div>
    These potential Top Concerns were selected based on the geographic regions used by the
    <a href="https://data.globalchange.gov/file/ca9c6f09-9890-41db-ace4-827f9cbeb93a" target="_blank">National Climate Assessment</a>
    and the potential future climate hazards that are most likely to exist.
    For more on this, visit our <a routerLink="/methodology">Methodology</a> page.
  </div>
</ng-template>
