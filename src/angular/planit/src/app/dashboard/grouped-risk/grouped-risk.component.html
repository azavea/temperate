<div class="grouped-risk-header">
  <h4 class="grouped-risk-title">
    <span class="grouped-risk-priority">
      <va-adaptive-need-box *ngIf="isAdaptiveNeedBoxVisible()"
                            [potentialImpact]="aggregateNeed.impact"
                            [adaptiveCapacity]="aggregateNeed.capacity"></va-adaptive-need-box>
      <span class="grouped-risk-priority-empty"
           *ngIf="!isAdaptiveNeedBoxVisible()"
           tooltip="As you assess your city’s vulnerability to this hazard, the color of
                    this square will reflect your city’s adaptive needs"
           placement="right"></span>
    </span>
    {{ weatherEvent.name }}
    <span class="risks-number">&bull; {{ risks.length }} risks</span>
  </h4>

  <div class="modal-triggers">
    <span class="indicators-trigger"
          container="body"
          tooltip="No related climate data"
          *ngIf="!canShowIndicators">
      <button class="indicators-trigger-button disabled button-icon-only"><span class="icon icon-indicators"></span></button>
    </span>

    <span class="indicators-trigger"
          tooltip="See related climate data"
          placement="top"
          container="body"
          *ngIf="canShowIndicators">
      <button class="indicators-trigger-button button-icon-only" (click)="openModal()"><span class="icon icon-indicators"></span></button>
    </span>
    <span class="map-impacts-trigger"
          tooltip="No related impacts with map data"
          placement="top"
          container="body"
          *ngIf="!canShowImpacts">
      <button class="indicators-trigger-button disabled button-icon-only"><span class="icon icon-map-marked-alt"></span></button>
    </span>
    <span class="map-impacts-trigger"
          tooltip="See related impacts on a map"
          placement="top"
          container="body"
          *ngIf="canShowImpacts">
      <button class="indicators-trigger-button button-icon-only" (click)="openMapModal()"><span class="icon icon-map-marked-alt"></span></button>
    </span>
  </div>
</div>

<div class="grouped-risk-summary">
  <div class="grouped-risk-progress-container grouped-risk-progress-assessment">
    <div class="grouped-risk-progress">
      <h5 class="grouped-risk-progress-title">Vulnerability assessment</h5>
      <span class="progress-percentage" *ngIf="percentRisksAssessed() > 0">{{ percentRisksAssessed() }}%</span>
      <progressbar [max]="risks.length" [value]="numberOfRisksAssessed()"></progressbar>
    </div>
    <a class="button button-small button-primary"
       routerLink="/assessment"
       [queryParams]="{hazard: weatherEvent?.id}">Assess</a>
  </div>

  <div class="grouped-risk-progress-container grouped-risk-progress-action"
       [ngClass]="(numberOfRisksAssessed() > 0) ? '' : 'grouped-risk-progress-action-empty'">
    <div class="grouped-risk-progress">
      <h5 class="grouped-risk-progress-title">Action steps</h5>
      <span class="progress-percentage" *ngIf="percentActionsAssessed() > 0">{{ percentActionsAssessed() }}%</span>
      <progressbar class="progress-bar-action" [max]="risks.length" [value]="numberOfActionsAssessed()"></progressbar>
    </div>
    <a class="button button-small button-positive"
       routerLink="/actions"
       [queryParams]="{hazard: weatherEvent?.id}"
       *ngIf="numberOfRisksAssessed() > 0">Take action</a>
    <div class="button button-small"
       *ngIf="numberOfRisksAssessed() === 0">Take action</div>
  </div>
</div>

<app-modal-template #indicatorChartModal
  title="Climate data related to {{ modalRisk?.weather_event.name | lowercase }}">
  <p>
    These climate change data indicators may help you think through the probability and
    frequency of this hazard. You may also want to consult the
    <a href="https://data.globalchange.gov/file/ca9c6f09-9890-41db-ace4-827f9cbeb93a" target="_blank">
    National Climate Assessment,</a> <a href="http://statesatrisk.org/" target="_blank">States At Risk,</a> or use the help icon to contact
    ICLEI-USA.
  </p>

  <app-force-collapse-chart-container
      [indicators]="indicators"
      [location]="location">
  </app-force-collapse-chart-container>
  <footer class="modal-footer">
    <button class="button" (click)="goToIndicators()">See all climate data</button>
  </footer>
</app-modal-template>

<app-modal-template #impactsMapModal
  title="Maps related to {{ modalRisk?.weather_event.name | lowercase }}">
  <app-impact-map
    [impacts]="impacts"
  ></app-impact-map>
</app-modal-template>
