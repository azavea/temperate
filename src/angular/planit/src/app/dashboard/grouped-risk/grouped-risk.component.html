<div class="hazard-header">
  <h4 class="hazard-title">
    <span class="hazard-priority">
      <va-adaptive-need-box *ngIf="isAdaptiveNeedBoxVisible()"
                            [potentialImpact]="aggregateNeed.impact"
                            [adaptiveCapacity]="aggregateNeed.capacity"></va-adaptive-need-box>
      <span class="hazard-priority-empty" 
           *ngIf="!isAdaptiveNeedBoxVisible()"
           tooltip="When you assess risks, an aggregate of their adaptive need appears here"
           placement="right">--</span>
    </span>
    {{ weatherEvent.name }}
    <span class="hazard-risks-number">&bull; {{ risks.length }} risks</span>
  </h4>

  <span class="hazard-indicators-trigger" [tooltip]="noRelatedIndicatorsTooltip"
       [isDisabled]="canShowIndicators">
    <button class="button-icon-only" tooltip="See related indicators" type="button"
            [ngClass]="{disabled: !canShowIndicators}"
            (click)="openModal()"><span class="icon icon-indicators"></span></button>
  </span>
</div>

<div class="hazard-summary">
  <div class="hazard-assessment-block hazard-block">
    <div class="hazard-assessment-progress hazard-block-progress">
      <h5 class="hazard-assessment-title hazard-block-title">Vulnerability assessment</h5>
      <span class="progress-percentage">{{ percentRisksAssessed() }} %</span>
      <progressbar [max]="risks.length" [value]="numberOfRisksAssessed()"></progressbar>
    </div>
    <a class="button button-small button-primary" 
       routerLink="/assessment"
       [queryParams]="{hazard: weatherEvent?.id}">Assess</a>
  </div>
  

  <div class="hazard-action-block hazard-block" *ngIf="numberOfRisksAssessed() > 0">
    <div class="hazard-action-progress hazard-block-progress">
      <h5 class="hazard-action-title hazard-block-title">Action steps</h5>
      <span class="progress-percentage">{{ percentActionsAssessed() }} %</span>
      <progressbar [max]="risks.length" [value]="numberOfActionsAssessed()"></progressbar>
    </div>
    <a class="button button-small button-positive"
       routerLink="/actions"
       [queryParams]="{hazard: weatherEvent?.id}">Take action</a>
  </div>
</div>

<app-modal-template #indicatorChartModal
  title="Indicators related to {{ modalRisk?.weather_event.name | lowercase }}">
  <app-force-collapse-chart-container
      [indicators]="indicators"
      [city]="city">
  </app-force-collapse-chart-container>
  <footer class="modal-footer">
    <button class="button button-inverse-dark" (click)="goToIndicators()">See all indicators</button>
  </footer>
</app-modal-template>

<ng-template #noRelatedIndicatorsTooltip>
  No related indicators for {{ modalRisk?.weather_event.name }}
</ng-template>
