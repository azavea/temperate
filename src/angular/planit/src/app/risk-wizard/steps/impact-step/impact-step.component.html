<div class="step-header">
  <div *ngIf="isDisabled" class="alert alert-warning">
    You must match a hazard to a community system to complete this step.
  </div>
  <h3 class="step-title">Potential Impact</h3>
  <p *ngIf="!isDisabled">
    How much impact might this hazard have on <strong>{{ risk.community_system?.name | lowercase }}</strong> over the next five years?</p>
</div>

<div class="step-content">
  <form [formGroup]="form">
    <div class="form-control-container">
      <label for="potential-impact">Potential impact</label>
      <app-option-dropdown buttonId="potential-impact"
                           [control]="form.controls['impact_magnitude']"
                           [options]="relativeOptions"
                           [disabled]="isDisabled">
      </app-option-dropdown>
    </div>
    <div class="form-control-container">
      <label for="impact-description">
        Describe the expected impact on your community
        <span class="optional">optional</span>
      </label>
      <textarea id="impact-description" formControlName="impact_description"></textarea>
    </div>
    <div class="top-impacts" *ngIf="impacts.length > 0 && risk.weather_event && risk.community_system">
      <h3>Effects of {{ risk.title() }}</h3>
      <p>
        Below are some of the effects that {{ risk.weather_event.name | lowercase }} is likely to have on {{ risk.community_system.name | lowercase }},
        based on climate data. Use these details to help form your description above.
      </p>
      <ng-container *ngFor="let impact of impacts; index as i">
        <div
          class="impact"
          *ngIf="showAllImpacts || i < initialImpactsToShow">
          {{ impact.tagline ? impact.tagline : impact.label }}
          <a class="paste-link" (click)="pasteImpact(impact)">Paste above</a>
          <span class="map-impacts-trigger"
                tooltip="See related impacts on a map"
                placement="top"
                container="body"
                *ngIf="impact.map_layer">
            <button
              class="map-impacts-trigger-button button-icon-only"
              (click)="openMapModal(impact)"
            >
              <span class="icon icon-map-marked-alt"></span>
            </button>
          </span>
        </div>
      </ng-container>
      <a
        class="show-all-impacts"
        (click)="showAllImpacts = !showAllImpacts"
        *ngIf="impacts.length > initialImpactsToShow">
        <ng-container *ngIf="!showAllImpacts">
          More <i class="icon icon-chevron-down"></i>
        </ng-container>
        <ng-container *ngIf="showAllImpacts">
          Less <i class="icon icon-chevron-up"></i>
        </ng-container>
      </a>
    </div>
  </form>
</div>

<footer class="step-footer">
  <div class="step-footer-exit">
    <button type="button" class="button-link"
            *ngIf="!risk?.id"
            (click)="cancel()">Cancel</button>
    <button type="button" class="button-link"
            *ngIf="risk?.id"
            (click)="finish()">Finish assessment later</button>
  </div>
  <div class="step-footer-navigation">
    <button type="button" class="button"
            nextStep>Skip step</button>
    &nbsp;
    <button type="button" class="button button-primary"
            [disabled]="form.invalid || !isStepComplete()"
            nextStep>Next</button>
  </div>
</footer>

<app-impact-map-modal #impactsMapModal
  title="Maps related to {{ risk.weather_event?.name }} or {{ risk.community_system?.name }}"
  [impacts]="impacts"
  [impact]="mapImpact"
  (modalHide)="mapImpact = null">
</app-impact-map-modal>
